<!DOCTYPE html>
<html>
<head>
    <title>Liquidation Test</title>
</head>
<body>
    <h1>Liquidation Test</h1>
    <button onclick="testLiquidation()">Test Liquidation API</button>
    <div id="result"></div>

    <script>
    async function testLiquidation() {
        try {
            const response = await fetch('http://localhost:5001/api/liquidation/BTCUSDT');
            const data = await response.json();
            
            console.log('Raw data:', data);
            
            // Test the same logic as in the main app
            const liquidationData = data.liquidation_analysis || data.liquidation_data || {};
            const currentPrice = liquidationData.current_price || data.current_price || 0;
            const sentiment = liquidationData.funding_analysis?.sentiment || liquidationData.sentiment || 'NEUTRAL';
            
            console.log('Current Price:', currentPrice);
            console.log('Sentiment:', sentiment);
            
            const liquidationLevels = liquidationData.liquidation_levels || [];
            console.log('Liquidation Levels Count:', liquidationLevels.length);
            
            if (liquidationLevels.length > 0) {
                console.log('First level:', liquidationLevels[0]);
                
                // Test the render logic
                liquidationLevels.forEach(liq => {
                    const intensity = liq.intensity || 'MEDIUM';
                    const fundingRate = liq.funding_rate || 0;
                    const maintenanceMargin = liq.maintenance_margin || 0;
                    
                    console.log(`Level ${liq.leverage}x: intensity=${intensity}, funding=${fundingRate}, margin=${maintenanceMargin}`);
                });
            }
            
            document.getElementById('result').innerHTML = `
                <h2>✅ Test Successful!</h2>
                <p>Current Price: $${currentPrice.toLocaleString()}</p>
                <p>Sentiment: ${sentiment}</p>
                <p>Levels: ${liquidationLevels.length}</p>
            `;
            
        } catch (error) {
            console.error('Test failed:', error);
            document.getElementById('result').innerHTML = `
                <h2>❌ Test Failed!</h2>
                <p>Error: ${error.message}</p>
            `;
        }
    }
    </script>
</body>
</html>
